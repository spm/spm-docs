# Deformations  
Utility for working with deformation fields.   
They can be loaded, inverted, combined etc, and the results either saved to disk, or applied to some image or surface file. This utility was intended for imaging experts and may therefore not be straightforward to use without first understanding a few concepts, like "composition" and "inversion".   

* **Composition** (create a list of items)  
Deformation fields can be thought of as mappings. These can be combined by the operation of "composition", which is usually denoted by a circle "o". Suppose x:A->B and y:B->C are two mappings, where A, B and C refer to domains in 3 dimensions. Each element a in A points to element x(a) in B. This in turn points to element y(x(a)) in C, so we have a mapping from A to C. The composition of these mappings is denoted by yox:A->C. Compositions can be combined in an associative way, such that zo(yox) = (zoy)ox.   
In this utility, the right-to-left order of the compositions is from top to bottom (note that the rightmost deformation would actually be applied first).   

    * **Dartel flow**   
    Imported Dartel flow field.   

        * **Flow field** (select files)  
        The flow field stores the deformation information. The same field can be used for both forward or backward deformations (or even, in principle, half way or exaggerated deformations).   

        * **Forward/Backwards** (choose from the menu)  
        The direction of the Dartel flow.  Note that a backward transform will warp an individual subject's to match the template (ie maps from template to individual). A forward transform will warp the template image to the individual.   

        * **Time Steps** (choose from the menu)  
        The number of time points used for solving the partial differential equations.  A single time point would be equivalent to a small deformation model. Smaller values allow faster computations, but are less accurate in terms of inverse consistency and may result in the one-to-one mapping breaking down.   

        * **Dartel Template** (select files)  
        Select the final Template file generated by Dartel. This will be affine registered with a TPM file, such that the resulting spatially normalised images are closer aligned to MNI space. Leave empty if you do not wish to incorporate a transform to MNI space (i.e., just click **done** on the file selector, without selecting any images).   

    * **Deformation Field** (select files)  
    Deformations can be thought of as vector fields, and represented by three-volume images.  In SPM, deformation fields are saved in NIfTI format, with dimensions xdim x ydim x zdim x 1 x 3. Each voxel contains the x, y and z mm coordinates of where the deformation points.   

    * **Identity (Reference Image)**   
    This option generates an identity transform, but this can be useful for changing the dimensions of the resulting deformation (and any images that are generated from it).  Dimensions, orientation etc are derived from an image.   

        * **Image to base Id on** (select files)  
        Specify the image file on which to base the dimensions, orientation etc.   

    * **Identity (Bounding Box and Voxel Size)**   
    This option generates an identity transform, but this can be useful for changing the dimensions of the resulting deformation (and any images that are generated from it).  Dimensions, orientation etc are derived from a specified bounding box and voxel dimensions.   

        * **Voxel sizes** (enter text)  
        Specify the voxel sizes of the deformation field to be produced. Non-finite values will default to the voxel sizes of the template image that was originally used to estimate the deformation.   

        * **Bounding box** (enter text)  
        Specify the bounding box of the deformation field to be produced. Non-finite values will default to the bounding box of the template image that was originally used to estimate the deformation.   

    * **Imported _sn.mat**   
    Spatial normalisation, and the unified segmentation model of SPM5 save a parameterisation of deformation fields.  These consist of a combination of an affine transform, and nonlinear warps that are parameterised by a linear combination of cosine transform basis functions.  These are saved in *_sn.mat files, which can be converted to deformation fields.   

        * **Parameter File** (select files)  
        Specify the ``_sn.mat`` to be used.   

        * **Voxel sizes** (enter text)  
        Specify the voxel sizes of the deformation field to be produced. Non-finite values will default to the voxel sizes of the template image that was originally used to estimate the deformation.   

        * **Bounding box** (enter text)  
        Specify the bounding box of the deformation field to be produced. Non-finite values will default to the bounding box of the template image that was originally used to estimate the deformation.   

    * **Inverse**   
    Creates the inverse of a deformation field. Deformations are assumed to be one-to-one, in which case they have a unique inverse.  If y':A->B is the inverse of y:B->A, then y' o y = y o y' = Id, where Id is the identity transform.   
    .   
    Deformations are inverted using the method described in the appendix of  Ashburner J, Andersson JLR & Friston KJ (2000) "Image Registration using a Symmetric Prior - in Three-Dimensions." Human Brain Mapping 9(4):212-225   

        * **Composition** (create a list of items)  

            * **Dartel flow**   
            Imported Dartel flow field.   

                * **Flow field** (select files)  
                The flow field stores the deformation information. The same field can be used for both forward or backward deformations (or even, in principle, half way or exaggerated deformations).   

                * **Forward/Backwards** (choose from the menu)  
                The direction of the Dartel flow.  Note that a backward transform will warp an individual subject's to match the template (ie maps from template to individual). A forward transform will warp the template image to the individual.   

                * **Time Steps** (choose from the menu)  
                The number of time points used for solving the partial differential equations.  A single time point would be equivalent to a small deformation model. Smaller values allow faster computations, but are less accurate in terms of inverse consistency and may result in the one-to-one mapping breaking down.   

                * **Dartel Template** (select files)  
                Select the final Template file generated by Dartel. This will be affine registered with a TPM file, such that the resulting spatially normalised images are closer aligned to MNI space. Leave empty if you do not wish to incorporate a transform to MNI space (i.e., just click **done** on the file selector, without selecting any images).   

            * **Deformation Field** (select files)  
            Deformations can be thought of as vector fields, and represented by three-volume images.  In SPM, deformation fields are saved in NIfTI format, with dimensions xdim x ydim x zdim x 1 x 3. Each voxel contains the x, y and z mm coordinates of where the deformation points.   

            * **Identity (Reference Image)**   
            This option generates an identity transform, but this can be useful for changing the dimensions of the resulting deformation (and any images that are generated from it).  Dimensions, orientation etc are derived from an image.   

                * **Image to base Id on** (select files)  
                Specify the image file on which to base the dimensions, orientation etc.   

            * **Identity (Bounding Box and Voxel Size)**   
            This option generates an identity transform, but this can be useful for changing the dimensions of the resulting deformation (and any images that are generated from it).  Dimensions, orientation etc are derived from a specified bounding box and voxel dimensions.   

                * **Voxel sizes** (enter text)  
                Specify the voxel sizes of the deformation field to be produced. Non-finite values will default to the voxel sizes of the template image that was originally used to estimate the deformation.   

                * **Bounding box** (enter text)  
                Specify the bounding box of the deformation field to be produced. Non-finite values will default to the bounding box of the template image that was originally used to estimate the deformation.   

            * **Imported _sn.mat**   
            Spatial normalisation, and the unified segmentation model of SPM5 save a parameterisation of deformation fields.  These consist of a combination of an affine transform, and nonlinear warps that are parameterised by a linear combination of cosine transform basis functions.  These are saved in *_sn.mat files, which can be converted to deformation fields.   

                * **Parameter File** (select files)  
                Specify the ``_sn.mat`` to be used.   

                * **Voxel sizes** (enter text)  
                Specify the voxel sizes of the deformation field to be produced. Non-finite values will default to the voxel sizes of the template image that was originally used to estimate the deformation.   

                * **Bounding box** (enter text)  
                Specify the bounding box of the deformation field to be produced. Non-finite values will default to the bounding box of the template image that was originally used to estimate the deformation.   

            * **Inverse**   

                * **Composition** (create a list of items)  

                    * **Dartel flow**   
                    Imported Dartel flow field.   

                    * **Deformation Field** (select files)  
                    Deformations can be thought of as vector fields, and represented by three-volume images.  In SPM, deformation fields are saved in NIfTI format, with dimensions xdim x ydim x zdim x 1 x 3. Each voxel contains the x, y and z mm coordinates of where the deformation points.   

                    * **Identity (Reference Image)**   
                    This option generates an identity transform, but this can be useful for changing the dimensions of the resulting deformation (and any images that are generated from it).  Dimensions, orientation etc are derived from an image.   

                    * **Identity (Bounding Box and Voxel Size)**   
                    This option generates an identity transform, but this can be useful for changing the dimensions of the resulting deformation (and any images that are generated from it).  Dimensions, orientation etc are derived from a specified bounding box and voxel dimensions.   

                    * **Imported _sn.mat**   
                    Spatial normalisation, and the unified segmentation model of SPM5 save a parameterisation of deformation fields.  These consist of a combination of an affine transform, and nonlinear warps that are parameterised by a linear combination of cosine transform basis functions.  These are saved in *_sn.mat files, which can be converted to deformation fields.   

                    * **Inverse**   

                    * **Composition** (create a list of items)  

                * **Image to base inverse on** (select files)  
                Specify the image file on which to base the dimensions, orientation etc.   

            * **Composition** (create a list of items)  

                * **Dartel flow**   
                Imported Dartel flow field.   

                    * **Flow field** (select files)  
                    The flow field stores the deformation information. The same field can be used for both forward or backward deformations (or even, in principle, half way or exaggerated deformations).   

                    * **Forward/Backwards** (choose from the menu)  
                    The direction of the Dartel flow.  Note that a backward transform will warp an individual subject's to match the template (ie maps from template to individual). A forward transform will warp the template image to the individual.   

                    * **Time Steps** (choose from the menu)  
                    The number of time points used for solving the partial differential equations.  A single time point would be equivalent to a small deformation model. Smaller values allow faster computations, but are less accurate in terms of inverse consistency and may result in the one-to-one mapping breaking down.   

                    * **Dartel Template** (select files)  
                    Select the final Template file generated by Dartel. This will be affine registered with a TPM file, such that the resulting spatially normalised images are closer aligned to MNI space. Leave empty if you do not wish to incorporate a transform to MNI space (i.e., just click **done** on the file selector, without selecting any images).   

                * **Deformation Field** (select files)  
                Deformations can be thought of as vector fields, and represented by three-volume images.  In SPM, deformation fields are saved in NIfTI format, with dimensions xdim x ydim x zdim x 1 x 3. Each voxel contains the x, y and z mm coordinates of where the deformation points.   

                * **Identity (Reference Image)**   
                This option generates an identity transform, but this can be useful for changing the dimensions of the resulting deformation (and any images that are generated from it).  Dimensions, orientation etc are derived from an image.   

                    * **Image to base Id on** (select files)  
                    Specify the image file on which to base the dimensions, orientation etc.   

                * **Identity (Bounding Box and Voxel Size)**   
                This option generates an identity transform, but this can be useful for changing the dimensions of the resulting deformation (and any images that are generated from it).  Dimensions, orientation etc are derived from a specified bounding box and voxel dimensions.   

                    * **Voxel sizes** (enter text)  
                    Specify the voxel sizes of the deformation field to be produced. Non-finite values will default to the voxel sizes of the template image that was originally used to estimate the deformation.   

                    * **Bounding box** (enter text)  
                    Specify the bounding box of the deformation field to be produced. Non-finite values will default to the bounding box of the template image that was originally used to estimate the deformation.   

                * **Imported _sn.mat**   
                Spatial normalisation, and the unified segmentation model of SPM5 save a parameterisation of deformation fields.  These consist of a combination of an affine transform, and nonlinear warps that are parameterised by a linear combination of cosine transform basis functions.  These are saved in *_sn.mat files, which can be converted to deformation fields.   

                    * **Parameter File** (select files)  
                    Specify the ``_sn.mat`` to be used.   

                    * **Voxel sizes** (enter text)  
                    Specify the voxel sizes of the deformation field to be produced. Non-finite values will default to the voxel sizes of the template image that was originally used to estimate the deformation.   

                    * **Bounding box** (enter text)  
                    Specify the bounding box of the deformation field to be produced. Non-finite values will default to the bounding box of the template image that was originally used to estimate the deformation.   

                * **Inverse**   

                    * **Composition** (create a list of items)  

                    * **Image to base inverse on** (select files)  
                    Specify the image file on which to base the dimensions, orientation etc.   

                * **Composition** (create a list of items)  

                    * **Dartel flow**   
                    Imported Dartel flow field.   

                    * **Deformation Field** (select files)  
                    Deformations can be thought of as vector fields, and represented by three-volume images.  In SPM, deformation fields are saved in NIfTI format, with dimensions xdim x ydim x zdim x 1 x 3. Each voxel contains the x, y and z mm coordinates of where the deformation points.   

                    * **Identity (Reference Image)**   
                    This option generates an identity transform, but this can be useful for changing the dimensions of the resulting deformation (and any images that are generated from it).  Dimensions, orientation etc are derived from an image.   

                    * **Identity (Bounding Box and Voxel Size)**   
                    This option generates an identity transform, but this can be useful for changing the dimensions of the resulting deformation (and any images that are generated from it).  Dimensions, orientation etc are derived from a specified bounding box and voxel dimensions.   

                    * **Imported _sn.mat**   
                    Spatial normalisation, and the unified segmentation model of SPM5 save a parameterisation of deformation fields.  These consist of a combination of an affine transform, and nonlinear warps that are parameterised by a linear combination of cosine transform basis functions.  These are saved in *_sn.mat files, which can be converted to deformation fields.   

        * **Image to base inverse on** (select files)  
        Specify the image file on which to base the dimensions, orientation etc.   

    * **Composition** (create a list of items)  
    Deformation fields can be thought of as mappings. These can be combined by the operation of "composition", which is usually denoted by a circle "o". Suppose x:A->B and y:B->C are two mappings, where A, B and C refer to domains in 3 dimensions. Each element a in A points to element x(a) in B. This in turn points to element y(x(a)) in C, so we have a mapping from A to C. The composition of these mappings is denoted by yox:A->C. Compositions can be combined in an associative way, such that zo(yox) = (zoy)ox.   
    In this utility, the right-to-left order of the compositions is from top to bottom (note that the rightmost deformation would actually be applied first).   

        * **Dartel flow**   
        Imported Dartel flow field.   

            * **Flow field** (select files)  
            The flow field stores the deformation information. The same field can be used for both forward or backward deformations (or even, in principle, half way or exaggerated deformations).   

            * **Forward/Backwards** (choose from the menu)  
            The direction of the Dartel flow.  Note that a backward transform will warp an individual subject's to match the template (ie maps from template to individual). A forward transform will warp the template image to the individual.   

            * **Time Steps** (choose from the menu)  
            The number of time points used for solving the partial differential equations.  A single time point would be equivalent to a small deformation model. Smaller values allow faster computations, but are less accurate in terms of inverse consistency and may result in the one-to-one mapping breaking down.   

            * **Dartel Template** (select files)  
            Select the final Template file generated by Dartel. This will be affine registered with a TPM file, such that the resulting spatially normalised images are closer aligned to MNI space. Leave empty if you do not wish to incorporate a transform to MNI space (i.e., just click **done** on the file selector, without selecting any images).   

        * **Deformation Field** (select files)  
        Deformations can be thought of as vector fields, and represented by three-volume images.  In SPM, deformation fields are saved in NIfTI format, with dimensions xdim x ydim x zdim x 1 x 3. Each voxel contains the x, y and z mm coordinates of where the deformation points.   

        * **Identity (Reference Image)**   
        This option generates an identity transform, but this can be useful for changing the dimensions of the resulting deformation (and any images that are generated from it).  Dimensions, orientation etc are derived from an image.   

            * **Image to base Id on** (select files)  
            Specify the image file on which to base the dimensions, orientation etc.   

        * **Identity (Bounding Box and Voxel Size)**   
        This option generates an identity transform, but this can be useful for changing the dimensions of the resulting deformation (and any images that are generated from it).  Dimensions, orientation etc are derived from a specified bounding box and voxel dimensions.   

            * **Voxel sizes** (enter text)  
            Specify the voxel sizes of the deformation field to be produced. Non-finite values will default to the voxel sizes of the template image that was originally used to estimate the deformation.   

            * **Bounding box** (enter text)  
            Specify the bounding box of the deformation field to be produced. Non-finite values will default to the bounding box of the template image that was originally used to estimate the deformation.   

        * **Imported _sn.mat**   
        Spatial normalisation, and the unified segmentation model of SPM5 save a parameterisation of deformation fields.  These consist of a combination of an affine transform, and nonlinear warps that are parameterised by a linear combination of cosine transform basis functions.  These are saved in *_sn.mat files, which can be converted to deformation fields.   

            * **Parameter File** (select files)  
            Specify the ``_sn.mat`` to be used.   

            * **Voxel sizes** (enter text)  
            Specify the voxel sizes of the deformation field to be produced. Non-finite values will default to the voxel sizes of the template image that was originally used to estimate the deformation.   

            * **Bounding box** (enter text)  
            Specify the bounding box of the deformation field to be produced. Non-finite values will default to the bounding box of the template image that was originally used to estimate the deformation.   

        * **Inverse**   

            * **Composition** (create a list of items)  

                * **Dartel flow**   
                Imported Dartel flow field.   

                    * **Flow field** (select files)  
                    The flow field stores the deformation information. The same field can be used for both forward or backward deformations (or even, in principle, half way or exaggerated deformations).   

                    * **Forward/Backwards** (choose from the menu)  
                    The direction of the Dartel flow.  Note that a backward transform will warp an individual subject's to match the template (ie maps from template to individual). A forward transform will warp the template image to the individual.   

                    * **Time Steps** (choose from the menu)  
                    The number of time points used for solving the partial differential equations.  A single time point would be equivalent to a small deformation model. Smaller values allow faster computations, but are less accurate in terms of inverse consistency and may result in the one-to-one mapping breaking down.   

                    * **Dartel Template** (select files)  
                    Select the final Template file generated by Dartel. This will be affine registered with a TPM file, such that the resulting spatially normalised images are closer aligned to MNI space. Leave empty if you do not wish to incorporate a transform to MNI space (i.e., just click **done** on the file selector, without selecting any images).   

                * **Deformation Field** (select files)  
                Deformations can be thought of as vector fields, and represented by three-volume images.  In SPM, deformation fields are saved in NIfTI format, with dimensions xdim x ydim x zdim x 1 x 3. Each voxel contains the x, y and z mm coordinates of where the deformation points.   

                * **Identity (Reference Image)**   
                This option generates an identity transform, but this can be useful for changing the dimensions of the resulting deformation (and any images that are generated from it).  Dimensions, orientation etc are derived from an image.   

                    * **Image to base Id on** (select files)  
                    Specify the image file on which to base the dimensions, orientation etc.   

                * **Identity (Bounding Box and Voxel Size)**   
                This option generates an identity transform, but this can be useful for changing the dimensions of the resulting deformation (and any images that are generated from it).  Dimensions, orientation etc are derived from a specified bounding box and voxel dimensions.   

                    * **Voxel sizes** (enter text)  
                    Specify the voxel sizes of the deformation field to be produced. Non-finite values will default to the voxel sizes of the template image that was originally used to estimate the deformation.   

                    * **Bounding box** (enter text)  
                    Specify the bounding box of the deformation field to be produced. Non-finite values will default to the bounding box of the template image that was originally used to estimate the deformation.   

                * **Imported _sn.mat**   
                Spatial normalisation, and the unified segmentation model of SPM5 save a parameterisation of deformation fields.  These consist of a combination of an affine transform, and nonlinear warps that are parameterised by a linear combination of cosine transform basis functions.  These are saved in *_sn.mat files, which can be converted to deformation fields.   

                    * **Parameter File** (select files)  
                    Specify the ``_sn.mat`` to be used.   

                    * **Voxel sizes** (enter text)  
                    Specify the voxel sizes of the deformation field to be produced. Non-finite values will default to the voxel sizes of the template image that was originally used to estimate the deformation.   

                    * **Bounding box** (enter text)  
                    Specify the bounding box of the deformation field to be produced. Non-finite values will default to the bounding box of the template image that was originally used to estimate the deformation.   

                * **Inverse**   

                    * **Composition** (create a list of items)  

                    * **Image to base inverse on** (select files)  
                    Specify the image file on which to base the dimensions, orientation etc.   

                * **Composition** (create a list of items)  

                    * **Dartel flow**   
                    Imported Dartel flow field.   

                    * **Deformation Field** (select files)  
                    Deformations can be thought of as vector fields, and represented by three-volume images.  In SPM, deformation fields are saved in NIfTI format, with dimensions xdim x ydim x zdim x 1 x 3. Each voxel contains the x, y and z mm coordinates of where the deformation points.   

                    * **Identity (Reference Image)**   
                    This option generates an identity transform, but this can be useful for changing the dimensions of the resulting deformation (and any images that are generated from it).  Dimensions, orientation etc are derived from an image.   

                    * **Identity (Bounding Box and Voxel Size)**   
                    This option generates an identity transform, but this can be useful for changing the dimensions of the resulting deformation (and any images that are generated from it).  Dimensions, orientation etc are derived from a specified bounding box and voxel dimensions.   

                    * **Imported _sn.mat**   
                    Spatial normalisation, and the unified segmentation model of SPM5 save a parameterisation of deformation fields.  These consist of a combination of an affine transform, and nonlinear warps that are parameterised by a linear combination of cosine transform basis functions.  These are saved in *_sn.mat files, which can be converted to deformation fields.   

            * **Image to base inverse on** (select files)  
            Specify the image file on which to base the dimensions, orientation etc.   

        * **Composition** (create a list of items)  

            * **Dartel flow**   
            Imported Dartel flow field.   

                * **Flow field** (select files)  
                The flow field stores the deformation information. The same field can be used for both forward or backward deformations (or even, in principle, half way or exaggerated deformations).   

                * **Forward/Backwards** (choose from the menu)  
                The direction of the Dartel flow.  Note that a backward transform will warp an individual subject's to match the template (ie maps from template to individual). A forward transform will warp the template image to the individual.   

                * **Time Steps** (choose from the menu)  
                The number of time points used for solving the partial differential equations.  A single time point would be equivalent to a small deformation model. Smaller values allow faster computations, but are less accurate in terms of inverse consistency and may result in the one-to-one mapping breaking down.   

                * **Dartel Template** (select files)  
                Select the final Template file generated by Dartel. This will be affine registered with a TPM file, such that the resulting spatially normalised images are closer aligned to MNI space. Leave empty if you do not wish to incorporate a transform to MNI space (i.e., just click **done** on the file selector, without selecting any images).   

            * **Deformation Field** (select files)  
            Deformations can be thought of as vector fields, and represented by three-volume images.  In SPM, deformation fields are saved in NIfTI format, with dimensions xdim x ydim x zdim x 1 x 3. Each voxel contains the x, y and z mm coordinates of where the deformation points.   

            * **Identity (Reference Image)**   
            This option generates an identity transform, but this can be useful for changing the dimensions of the resulting deformation (and any images that are generated from it).  Dimensions, orientation etc are derived from an image.   

                * **Image to base Id on** (select files)  
                Specify the image file on which to base the dimensions, orientation etc.   

            * **Identity (Bounding Box and Voxel Size)**   
            This option generates an identity transform, but this can be useful for changing the dimensions of the resulting deformation (and any images that are generated from it).  Dimensions, orientation etc are derived from a specified bounding box and voxel dimensions.   

                * **Voxel sizes** (enter text)  
                Specify the voxel sizes of the deformation field to be produced. Non-finite values will default to the voxel sizes of the template image that was originally used to estimate the deformation.   

                * **Bounding box** (enter text)  
                Specify the bounding box of the deformation field to be produced. Non-finite values will default to the bounding box of the template image that was originally used to estimate the deformation.   

            * **Imported _sn.mat**   
            Spatial normalisation, and the unified segmentation model of SPM5 save a parameterisation of deformation fields.  These consist of a combination of an affine transform, and nonlinear warps that are parameterised by a linear combination of cosine transform basis functions.  These are saved in *_sn.mat files, which can be converted to deformation fields.   

                * **Parameter File** (select files)  
                Specify the ``_sn.mat`` to be used.   

                * **Voxel sizes** (enter text)  
                Specify the voxel sizes of the deformation field to be produced. Non-finite values will default to the voxel sizes of the template image that was originally used to estimate the deformation.   

                * **Bounding box** (enter text)  
                Specify the bounding box of the deformation field to be produced. Non-finite values will default to the bounding box of the template image that was originally used to estimate the deformation.   

            * **Inverse**   

                * **Composition** (create a list of items)  

                    * **Dartel flow**   
                    Imported Dartel flow field.   

                    * **Deformation Field** (select files)  
                    Deformations can be thought of as vector fields, and represented by three-volume images.  In SPM, deformation fields are saved in NIfTI format, with dimensions xdim x ydim x zdim x 1 x 3. Each voxel contains the x, y and z mm coordinates of where the deformation points.   

                    * **Identity (Reference Image)**   
                    This option generates an identity transform, but this can be useful for changing the dimensions of the resulting deformation (and any images that are generated from it).  Dimensions, orientation etc are derived from an image.   

                    * **Identity (Bounding Box and Voxel Size)**   
                    This option generates an identity transform, but this can be useful for changing the dimensions of the resulting deformation (and any images that are generated from it).  Dimensions, orientation etc are derived from a specified bounding box and voxel dimensions.   

                    * **Imported _sn.mat**   
                    Spatial normalisation, and the unified segmentation model of SPM5 save a parameterisation of deformation fields.  These consist of a combination of an affine transform, and nonlinear warps that are parameterised by a linear combination of cosine transform basis functions.  These are saved in *_sn.mat files, which can be converted to deformation fields.   

                * **Image to base inverse on** (select files)  
                Specify the image file on which to base the dimensions, orientation etc.   

            * **Composition** (create a list of items)  

                * **Dartel flow**   
                Imported Dartel flow field.   

                    * **Flow field** (select files)  
                    The flow field stores the deformation information. The same field can be used for both forward or backward deformations (or even, in principle, half way or exaggerated deformations).   

                    * **Forward/Backwards** (choose from the menu)  
                    The direction of the Dartel flow.  Note that a backward transform will warp an individual subject's to match the template (ie maps from template to individual). A forward transform will warp the template image to the individual.   

                    * **Time Steps** (choose from the menu)  
                    The number of time points used for solving the partial differential equations.  A single time point would be equivalent to a small deformation model. Smaller values allow faster computations, but are less accurate in terms of inverse consistency and may result in the one-to-one mapping breaking down.   

                    * **Dartel Template** (select files)  
                    Select the final Template file generated by Dartel. This will be affine registered with a TPM file, such that the resulting spatially normalised images are closer aligned to MNI space. Leave empty if you do not wish to incorporate a transform to MNI space (i.e., just click **done** on the file selector, without selecting any images).   

                * **Deformation Field** (select files)  
                Deformations can be thought of as vector fields, and represented by three-volume images.  In SPM, deformation fields are saved in NIfTI format, with dimensions xdim x ydim x zdim x 1 x 3. Each voxel contains the x, y and z mm coordinates of where the deformation points.   

                * **Identity (Reference Image)**   
                This option generates an identity transform, but this can be useful for changing the dimensions of the resulting deformation (and any images that are generated from it).  Dimensions, orientation etc are derived from an image.   

                    * **Image to base Id on** (select files)  
                    Specify the image file on which to base the dimensions, orientation etc.   

                * **Identity (Bounding Box and Voxel Size)**   
                This option generates an identity transform, but this can be useful for changing the dimensions of the resulting deformation (and any images that are generated from it).  Dimensions, orientation etc are derived from a specified bounding box and voxel dimensions.   

                    * **Voxel sizes** (enter text)  
                    Specify the voxel sizes of the deformation field to be produced. Non-finite values will default to the voxel sizes of the template image that was originally used to estimate the deformation.   

                    * **Bounding box** (enter text)  
                    Specify the bounding box of the deformation field to be produced. Non-finite values will default to the bounding box of the template image that was originally used to estimate the deformation.   

                * **Imported _sn.mat**   
                Spatial normalisation, and the unified segmentation model of SPM5 save a parameterisation of deformation fields.  These consist of a combination of an affine transform, and nonlinear warps that are parameterised by a linear combination of cosine transform basis functions.  These are saved in *_sn.mat files, which can be converted to deformation fields.   

                    * **Parameter File** (select files)  
                    Specify the ``_sn.mat`` to be used.   

                    * **Voxel sizes** (enter text)  
                    Specify the voxel sizes of the deformation field to be produced. Non-finite values will default to the voxel sizes of the template image that was originally used to estimate the deformation.   

                    * **Bounding box** (enter text)  
                    Specify the bounding box of the deformation field to be produced. Non-finite values will default to the bounding box of the template image that was originally used to estimate the deformation.   

* **Output** (create a list of items)  
Various output options are available.  The deformation may be saved to disk as a ``y_*.nii`` file.Images may be warped using the resulting deformation, either using a "pullback" procedure, or a "pushforward".The old style of spatial normalisation involved the pullback, whereas the pushforward requires the inverse of the deformation used by the pullback.  Finally, the deformation may be used to warp a GIFTI surface file.   

    * **Save Deformation**   
    The deformation may be saved to disk as a ``y_*.nii`` file.   

        * **Save as** (enter text)  
        Save the result as a three-volume image.  ``y_`` will be prepended to the filename.   

        * **Output destination** (choose an option)  

            * **Current directory**   
            All created files (deformation fields and warped images) are written to the current directory.   

            * **Output directory** (select files)  
            The combined deformation field and the warped images are written into the specified directory.   

    * **Pullback**   
    This is the old way of warping images, which involves resampling images based on a mapping from the new (warped) image space back to the original image.  The deformation should be the inverse of the deformation that would be used for the pushforward procedure.   

        * **Apply to** (select files)  
        Apply the resulting deformation field to some images. The filenames will be prepended by ``w``.   

        * **Output destination** (choose an option)  

            * **Current directory**   
            All created files (deformation fields and warped images) are written to the current directory.   

            * **Source directories**   
            The combined deformation field is written into the directory of the first deformation field, warped images are written to the same directories as the source images.   

            * **Output directory** (select files)  
            The combined deformation field and the warped images are written into the specified directory.   

        * **Interpolation** (choose from the menu)  
        The method by which the images are sampled when being written in a different space. (Note that Inf or NaN values are treated as zero, rather than as missing data)   
            1. **Nearest Neighbour**   
              Fastest, but not normally recommended.   
            2. **Trilinear Interpolation**   
              OK for PET, realigned fMRI, or segmentations   
            3. **B-spline Interpolation**   
              Better quality (but slower) interpolation, especially with higher degree splines. Can produce values outside the original range (e.g. small negative values from an originally all positive image).   
            4. **Categorical**   
              Slow (particularly when there are lots of categories). This is intended to warp categorical images such as label maps.   

        * **Masking** (choose from the menu)  
        Because of subject motion, different images are likely to have different patterns of zeros from where it was not possible to sample data. With masking enabled, the program searches through the whole time series looking for voxels which need to be sampled from outside the original images. Where this occurs, that voxel is set to zero for the whole set of images (unless the image format can represent NaN, in which case NaNs are used where possible).   

        * **Gaussian FWHM** (enter text)  
        Specify the full-width at half maximum (FWHM) of the Gaussian blurring kernel in mm. Three values should be entered, denoting the FWHM in the x, y and z directions.   

        * **Filename Prefix** (enter text)  
        The name of the output file(s) will be the name of the input file(s) prefixed with this prefix. Leave empty to use SPM default prefixes.   

    * **Pushforward**   
    This is a newer way of warping images (for SPM at least), and involves the forward pushing of voxel values from the original image into the appropriate place in the warped image. The deformation field should be the inverse of the one used for the pullback procedure.   
    .   
    Smoothed (blurred) spatially normalised images are generated in such a way that the original signal is preserved. Normalised images are generated by a "pushing" rather than a "pulling" (the usual) procedure. Note that a procedure related to trilinear interpolation is used, and no masking is done.  It is therefore recommended that the images are realigned and resliced before they are spatially normalised, in order to benefit from motion correction using higher order interpolation.  Alternatively, contrast images generated from unsmoothed native-space fMRI/PET data can be spatially normalised for a 2nd level analysis.   
    Two "preserve" options are provided.  One of them should do the equavalent of generating smoothed "modulated" spatially normalised images.  The other does the equivalent of smoothing the modulated normalised fMRI/PET, and dividing by the smoothed Jacobian determinants.   

        * **Apply to** (select files)  
        Apply the resulting deformation field to some images. The filenames will be prepended by ``w``.   

        * **Weight Image** (select files)  
        Select an image file to weight the warped data with.  This is optional, but the idea is the same as was used by JE Lee et al (2009) in their "A study of diffusion tensor imaging by tissue-specific, smoothing-compensated voxel-based analysis" paper.  In principle, a mask of (eg) white matter could be supplied, such that the warped images contain average signal intensities in WM.   

        * **Output destination** (choose an option)  

            * **Current directory**   
            All created files (deformation fields and warped images) are written to the current directory.   

            * **Source directories**   
            The combined deformation field is written into the directory of the first deformation field, warped images are written to the same directories as the source images.   

            * **Output directory** (select files)  
            The combined deformation field and the warped images are written into the specified directory.   

        * **Field of View** (choose an option)  
        The dimensions and voxel size of the resulting deformation may be defined from some image, or by specifying voxel sizes and a bounding box.   

            * **Image Defined** (select files)  
            Use the dimensions, orientation etc of some pre-existing image.   

            * **User Defined**   
            The part of the deformation to use is specified by defining the bounding box and voxel sizes that you would like to have. This is probably stating the obvious to many but smaller voxels and a broader bounding box will take up more disk space, but may give a little more accuracy.   

                * **Bounding box** (enter text)  
                Specify the bounding box of the deformation field to be produced. Non-finite values will default to the bounding box of the template image that was originally used to estimate the deformation.   

                * **Voxel sizes** (enter text)  
                Specify the voxel sizes of the deformation field to be produced. Non-finite values will default to the voxel sizes of the template image that was originally used to estimate the deformation.   

        * **Preserve** (choose from the menu)  
            * Preserve Concentrations: Smoothed spatially normalised images (sw*) represent weighted averages of the signal under the smoothing kernel, approximately preserving the intensities of the original images. This option is currently suggested for eg fMRI.   
            * Preserve Amount: Smoothed and spatially normalised images preserve the total amount of signal from each region in the images (smw*). Areas that are expanded during warping are correspondingly reduced in intensity. This option is suggested for VBM.   
            * Preserve Labels: This is intended for warping label images. While it is quite slow to run, it is intended to give more accurately warped categorical data.   

        * **Gaussian FWHM** (enter text)  
        Specify the full-width at half maximum (FWHM) of the Gaussian blurring kernel in mm. Three values should be entered, denoting the FWHM in the x, y and z directions. Note that you can specify [0 0 0], but any "modulated" data will show aliasing, which occurs because of the way the warped images are generated.   

        * **Filename Prefix** (enter text)  
        The name of the output file(s) will be the name of the input file(s) prefixed with this prefix. Leave empty to use SPM default prefixes.   

    * **Surface**   
    Surfaces may be warped using the resulting deformation. Note that a procedure similar to the pushforward is used, so the deformation should be the inverse of the one that would be used for spatially normalising images via the pullback procedure.   

        * **Surface** (select files)  
        Select a GIFTI file to warp.   

        * **Output destination** (choose an option)  

            * **Current directory**   
            All created files (deformation fields and warped images) are written to the current directory.   

            * **Source directories**   
            The combined deformation field is written into the directory of the first deformation field, warped images are written to the same directories as the source images.   

            * **Output directory** (select files)  
            The combined deformation field and the warped images are written into the specified directory.   

    * **Save Jacobian Determinants**   
    The Jacobian determinants may be saved to disk as a ``j_*.nii`` file.   

        * **Save as** (enter text)  
        Save the Jacobian determinants as an image.  ``j_`` will be prepended to the filename.   

        * **Output destination** (choose an option)  

            * **Current directory**   
            All created files (deformation fields and warped images) are written to the current directory.   

            * **Output directory** (select files)  
            The combined deformation field and the warped images are written into the specified directory.   
